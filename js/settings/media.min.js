!function(e){function t(e){n.reset(),_.each(e,function(e,t){n.addItem(e)})}function i(){n.addItem({name:"",key:"image-size-"+(n.items.length+1),width:100,height:100,selectable:!1,crop:!0})}function s(){n=new o({el:e(".sizes-list").get(0)}),r=e(".sizes-list .placeholder"),t(l.sizes.current),e(".robocrop-sizes-table .save-theme").prop("disabled",!l.theme_sizes_enabled),e(".robocrop-sizes-table .load-theme").prop("disabled",!l.theme_sizes_enabled||!1===l.sizes.theme)}var a,o,n,r,l=wp_robocrop_settings.options;wp_robocrop_settings.l10n;e(document).on("change",'.robocrop-manage-sizes [type="checkbox"]',function(t){e(this).closest("tr").toggleClass("off",!e(this).prop("checked"))}),o=wp.media.View.extend({initialize:function(){return wp.media.View.prototype.initialize.apply(this,arguments),this.$placeholder=this.$(".placeholder"),this.items=[],this},addItem:function(e){this.$placeholder.parent().length>0&&this.$placeholder.remove();var t=new a({model:e,controller:this});return this.$el.append(t.render().el),this.items.push(t),this},removeItem:function(e){var t;return e.$el.remove(),0===this.$el.children().length&&this.$placeholder.appendTo(this.el),t=this.items.indexOf(e),t>-1&&this.items.splice(t,1),this},reset:function(){for(;this.items.length;)this.removeItem(this.items.pop());return this}}),SizeScaledView=wp.media.View.extend({tagName:"tr",className:"scaled-item",template:wp.template("robocrop-settings-scaled-size"),events:{'change [data-prop="scaled-key"]':function(t){var i=_.template("robocrop_sizes[<%= data.size_key %>][scaled][<%= data.key %>]"),s=_.extend(this.options.model,{key:e(t.target).val()}),a=i({data:s});this.$('[data-prop="scaled-factor"]').attr("name",a)},"click .remove-scaled":function(e){e.preventDefault(),this.$el.remove()}},render:function(){return wp.media.View.prototype.render.apply(this,arguments),this.$('[data-prop="scaled-key"]').val(this.options.model.key),this.$('[data-prop="scaled-factor"]').val(this.options.model.factor),this},prepare:function(){return this.options.model}}),a=wp.media.View.extend({tagName:"tr",className:"size-item",template:wp.template("robocrop-settings-size"),events:{"click .remove-size":function(e){e.preventDefault(),this.controller.removeItem(this)},"click .add-scaled":function(e){e.preventDefault(),this.addScaled({factor:2,key:"scaled",size_key:this.model.key})},'change [data-prop="width"],[data-prop="height"]':"updateRatio"},initialize:function(){return wp.media.View.prototype.initialize.apply(this,arguments),this},render:function(){var e=this;return wp.media.View.prototype.render.apply(this,arguments),this.$scaledList=this.$(".scaled .scaled-list"),this.$ratio=this.$(".ratio"),this.$widthInp=this.$('[data-prop="width"]'),this.$heightInp=this.$('[data-prop="height"]'),_.each(this.options.model,function(t,i){var s=e.$('[data-prop="'+i+'"]');_.isBoolean(t)?s.prop("checked",t):_.isString(t)||_.isNumber(t)?s.val(t):"scaled"===i&&_.each(t,function(t,i){e.addScaled({factor:t,key:i,size_key:e.model.key})})}),this.updateRatio(),this},updateRatio:function(e){var t,i=parseInt(this.$widthInp.val()),s=parseInt(this.$heightInp.val()),a=function(e){var t=Math.pow(10,l.rounding_precision);return(Math.round(e*t)/t).toString(10)};t=i>=s?"1 : "+a(i/s):a(s/i)+" : 1",this.$ratio.text(t)},addScaled:function(e){new SizeScaledView({model:e}).render().$el.insertBefore(this.$scaledList.children().last())},prepare:function(){return this.options.model}}),e(document).ready(s).on("click",".robocrop-sizes-table .add",function(e){e.preventDefault(),i()}).on("click",".robocrop-sizes-table .reset",function(e){e.preventDefault(),t(l.sizes.original)}).on("click",".robocrop-sizes-table .load-theme",function(e){e.preventDefault(),t(l.sizes.theme)})}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1lZGlhLmpzIl0sIm5hbWVzIjpbIiQiLCJzZXRTaXplcyIsInNpemVzIiwic2l6ZXNWaWV3IiwicmVzZXQiLCJfIiwiZWFjaCIsInNpemUiLCJpIiwiYWRkSXRlbSIsImFkZFNpemUiLCJuYW1lIiwia2V5IiwiaXRlbXMiLCJsZW5ndGgiLCJ3aWR0aCIsImhlaWdodCIsInNlbGVjdGFibGUiLCJjcm9wIiwiaW5pdCIsIlNpemVzVGFibGVWaWV3IiwiZWwiLCJnZXQiLCIkcGxhY2Vob2xkZXIiLCJvcHQiLCJjdXJyZW50IiwicHJvcCIsInRoZW1lX3NpemVzX2VuYWJsZWQiLCJ0aGVtZSIsIlNpemVSb3dWaWV3Iiwid3Bfcm9ib2Nyb3Bfc2V0dGluZ3MiLCJvcHRpb25zIiwibDEwbiIsImRvY3VtZW50Iiwib24iLCJlIiwidGhpcyIsImNsb3Nlc3QiLCJ0b2dnbGVDbGFzcyIsIndwIiwibWVkaWEiLCJWaWV3IiwiZXh0ZW5kIiwiaW5pdGlhbGl6ZSIsInByb3RvdHlwZSIsImFwcGx5IiwiYXJndW1lbnRzIiwiZGF0YSIsInBhcmVudCIsInJlbW92ZSIsIml0ZW0iLCJtb2RlbCIsImNvbnRyb2xsZXIiLCIkZWwiLCJhcHBlbmQiLCJyZW5kZXIiLCJwdXNoIiwicmVtb3ZlSXRlbSIsImlkeCIsImNoaWxkcmVuIiwiYXBwZW5kVG8iLCJpbmRleE9mIiwic3BsaWNlIiwicG9wIiwiU2l6ZVNjYWxlZFZpZXciLCJ0YWdOYW1lIiwiY2xhc3NOYW1lIiwidGVtcGxhdGUiLCJldmVudHMiLCJjaGFuZ2UgW2RhdGEtcHJvcD1cInNjYWxlZC1rZXlcIl0iLCJ0cGwiLCJ0YXJnZXQiLCJ2YWwiLCJhdHRyIiwiY2xpY2sgLnJlbW92ZS1zY2FsZWQiLCJwcmV2ZW50RGVmYXVsdCIsImZhY3RvciIsInByZXBhcmUiLCJjbGljayAucmVtb3ZlLXNpemUiLCJjbGljayAuYWRkLXNjYWxlZCIsImFkZFNjYWxlZCIsInNpemVfa2V5IiwiY2hhbmdlIFtkYXRhLXByb3A9XCJ3aWR0aFwiXSxbZGF0YS1wcm9wPVwiaGVpZ2h0XCJdIiwic2VsZiIsIiRzY2FsZWRMaXN0IiwiJHJhdGlvIiwiJHdpZHRoSW5wIiwiJGhlaWdodElucCIsIiRpbnAiLCJpc0Jvb2xlYW4iLCJpc1N0cmluZyIsImlzTnVtYmVyIiwidXBkYXRlUmF0aW8iLCJyYXRpbyIsInciLCJwYXJzZUludCIsImgiLCJybmQiLCJudW0iLCJwcmVjIiwiTWF0aCIsInBvdyIsInJvdW5kaW5nX3ByZWNpc2lvbiIsInJvdW5kIiwidG9TdHJpbmciLCJ0ZXh0IiwiaW5zZXJ0QmVmb3JlIiwibGFzdCIsInJlYWR5Iiwib3JpZ2luYWwiLCJqUXVlcnkiXSwibWFwcGluZ3MiOiJDQUFBLFNBQVVBLEdBcUpULFFBQVNDLEdBQVVDLEdBQ2xCQyxFQUFVQyxRQUNWQyxFQUFFQyxLQUFNSixFQUFPLFNBQVVLLEVBQU1DLEdBQzlCTCxFQUFVTSxRQUFTRixLQUdyQixRQUFTRyxLQUNSUCxFQUFVTSxTQUNURSxLQUFLLEdBQ0xDLElBQUksZUFBaUJULEVBQVVVLE1BQU1DLE9BQVMsR0FDOUNDLE1BQU0sSUFDTkMsT0FBTyxJQUNQQyxZQUFXLEVBQ1hDLE1BQUssSUFHUCxRQUFTQyxLQUNSaEIsRUFBWSxHQUFJaUIsSUFBa0JDLEdBQUlyQixFQUFFLGVBQWVzQixJQUFJLEtBQzNEQyxFQUFldkIsRUFBRSw0QkFDakJDLEVBQVV1QixFQUFJdEIsTUFBTXVCLFNBQ3BCekIsRUFBRSxxQ0FBcUMwQixLQUFLLFlBQWNGLEVBQUlHLHFCQUM5RDNCLEVBQUUscUNBQ0EwQixLQUFLLFlBQWNGLEVBQUlHLHNCQUEyQyxJQUFwQkgsRUFBSXRCLE1BQU0wQixPQTFLM0QsR0FFQ0MsR0FDQVQsRUFDQWpCLEVBQ0FvQixFQUxHQyxFQUFNTSxxQkFBcUJDLE9BQ3ZCRCxzQkFBcUJFLElBTTdCaEMsR0FBRWlDLFVBQVVDLEdBQUcsU0FBUywyQ0FBMkMsU0FBU0MsR0FDM0VuQyxFQUFFb0MsTUFBTUMsUUFBUSxNQUFNQyxZQUFZLE9BQU90QyxFQUFFb0MsTUFB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QU0yRyxZQUVwQjNFLEdBQUcsUUFBUSxvQ0FBcUMsU0FBU0MsR0FDekRBLEVBQUV3QyxpQkFDRjFFLEVBQVV1QixFQUFJdEIsTUFBTTBCLFVBR3BCa0YiLCJmaWxlIjoibWVkaWEubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCQpe1xuXHR2YXIgb3B0ID0gd3Bfcm9ib2Nyb3Bfc2V0dGluZ3Mub3B0aW9ucyxcblx0XHRsMTBuID0gd3Bfcm9ib2Nyb3Bfc2V0dGluZ3MubDEwbixcblx0XHRTaXplUm93Vmlldyxcblx0XHRTaXplc1RhYmxlVmlldyxcblx0XHRzaXplc1ZpZXcsXG5cdFx0JHBsYWNlaG9sZGVyO1xuXHQvLyB0b2dnbGUgc2l6ZXMgc2V0dGluZ3Ncblx0JChkb2N1bWVudCkub24oJ2NoYW5nZScsJy5yb2JvY3JvcC1tYW5hZ2Utc2l6ZXMgW3R5cGU9XCJjaGVja2JveFwiXScsZnVuY3Rpb24oZSl7XG5cdFx0JCh0aGlzKS5jbG9zZXN0KCd0cicpLnRvZ2dsZUNsYXNzKCdvZmYnLCEkKHRoaXMpLnByb3AoJ2NoZWNrZWQnKSlcblx0fSk7XG5cdFNpemVzVGFibGVWaWV3ID0gd3AubWVkaWEuVmlldy5leHRlbmQoe1xuXHRcdGluaXRpYWxpemU6ZnVuY3Rpb24oKXtcblx0XHRcdHdwLm1lZGlhLlZpZXcucHJvdG90eXBlLmluaXRpYWxpemUuYXBwbHkodGhpcyxhcmd1bWVudHMpO1xuXHRcdFx0dGhpcy4kcGxhY2Vob2xkZXIgPSB0aGlzLiQoJy5wbGFjZWhvbGRlcicpO1xuXHRcdFx0dGhpcy5pdGVtcyA9IFtdO1xuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fSxcblx0XHRhZGRJdGVtOmZ1bmN0aW9uKCBkYXRhICkge1xuXHRcdFx0aWYgKCB0aGlzLiRwbGFjZWhvbGRlci5wYXJlbnQoKS5sZW5ndGggPiAwICkge1xuXHRcdFx0XHR0aGlzLiRwbGFjZWhvbGRlci5yZW1vdmUoKTtcblx0XHRcdH1cblx0XHRcdHZhciBpdGVtID0gbmV3IFNpemVSb3dWaWV3KHtcblx0XHRcdFx0bW9kZWxcdFx0OiBkYXRhLFxuXHRcdFx0XHRjb250cm9sbGVyXHQ6IHRoaXNcblx0XHRcdH0pO1xuXHRcdFx0dGhpcy4kZWwuYXBwZW5kKCBpdGVtLnJlbmRlcigpLmVsICk7XG5cdFx0XHR0aGlzLml0ZW1zLnB1c2goIGl0ZW0gKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0cmVtb3ZlSXRlbTpmdW5jdGlvbiggaXRlbSApIHtcblx0XHRcdHZhciBpZHg7XG5cdFx0XHRpdGVtLiRlbC5yZW1vdmUoKTtcblx0XHRcdGlmICggdGhpcy4kZWwuY2hpbGRyZW4oKS5sZW5ndGggPT09IDAgKSB7XG5cdFx0XHRcdHRoaXMuJHBsYWNlaG9sZGVyLmFwcGVuZFRvKHRoaXMuZWwpO1xuXHRcdFx0fVxuXHRcdFx0aWR4ID0gdGhpcy5pdGVtcy5pbmRleE9mKCBpdGVtICk7XG5cdFx0XHRpZiAoIGlkeCA+IC0xICkge1xuXHRcdFx0XHR0aGlzLml0ZW1zLnNwbGljZShpZHgsMSk7XG5cdFx0XHR9XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdHJlc2V0OmZ1bmN0aW9uKCkge1xuXHRcdFx0d2hpbGUoIHRoaXMuaXRlbXMubGVuZ3RoICkge1xuXHRcdFx0XHR0aGlzLnJlbW92ZUl0ZW0oIHRoaXMuaXRlbXMucG9wKCkgKVxuXHRcdFx0fVxuXHRcdFx0cmV0dXJuIHRoaXM7XG5cdFx0fVxuXHR9KTtcblx0U2l6ZVNjYWxlZFZpZXcgPSB3cC5tZWRpYS5WaWV3LmV4dGVuZCh7XG5cdFx0dGFnTmFtZVx0XHQ6ICd0cicsXG5cdFx0Y2xhc3NOYW1lXHQ6ICdzY2FsZWQtaXRlbScsXG5cdFx0dGVtcGxhdGVcdDogd3AudGVtcGxhdGUoJ3JvYm9jcm9wLXNldHRpbmdzLXNjYWxlZC1zaXplJyksXG5cdFx0ZXZlbnRzXHRcdDoge1xuXHRcdFx0J2NoYW5nZSBbZGF0YS1wcm9wPVwic2NhbGVkLWtleVwiXScgOiBmdW5jdGlvbihlKSB7XG5cdFx0XHRcdHZhciB0cGwgPSBfLnRlbXBsYXRlKCdyb2JvY3JvcF9zaXplc1s8JT0gZGF0YS5zaXplX2tleSAlPl1bc2NhbGVkXVs8JT0gZGF0YS5rZXkgJT5dJyksXG5cdFx0XHRcdFx0ZGF0YSA9IF8uZXh0ZW5kKCB0aGlzLm9wdGlvbnMubW9kZWwsIHtrZXk6JChlLnRhcmdldCkudmFsKCl9ICksXG5cdFx0XHRcdFx0bmFtZSA9IHRwbCh7ZGF0YTpkYXRhfSk7XG5cdFx0XHRcdHRoaXMuJCgnW2RhdGEtcHJvcD1cInNjYWxlZC1mYWN0b3JcIl0nKS5hdHRyKCduYW1lJyxuYW1lICk7XG5cdFx0XHR9LFxuXHRcdFx0J2NsaWNrIC5yZW1vdmUtc2NhbGVkJyA6IGZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdHRoaXMuJGVsLnJlbW92ZSgpO1xuXHRcdFx0fSxcblx0XHR9LFxuXHRcdHJlbmRlcjogZnVuY3Rpb24oKSB7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cdFx0XHR3cC5tZWRpYS5WaWV3LnByb3RvdHlwZS5yZW5kZXIuYXBwbHkodGhpcyxhcmd1bWVudHMpO1xuXHRcdFx0dGhpcy4kKCdbZGF0YS1wcm9wPVwic2NhbGVkLWtleVwiXScpLnZhbCh0aGlzLm9wdGlvbnMubW9kZWwua2V5KTtcblx0XHRcdHRoaXMuJCgnW2RhdGEtcHJvcD1cInNjYWxlZC1mYWN0b3JcIl0nKS52YWwodGhpcy5vcHRpb25zLm1vZGVsLmZhY3Rvcik7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdHByZXBhcmU6ZnVuY3Rpb24oKXtcblx0XHRcdHJldHVybiB0aGlzLm9wdGlvbnMubW9kZWw7XG5cdFx0fVxuXHR9KTtcblx0U2l6ZVJvd1ZpZXcgPSB3cC5tZWRpYS5WaWV3LmV4dGVuZCh7XG5cdFx0dGFnTmFtZTondHInLFxuXHRcdGNsYXNzTmFtZTonc2l6ZS1pdGVtJyxcblx0XHR0ZW1wbGF0ZTogd3AudGVtcGxhdGUoJ3JvYm9jcm9wLXNldHRpbmdzLXNpemUnKSxcblx0XHRldmVudHM6e1xuXHRcdFx0J2NsaWNrIC5yZW1vdmUtc2l6ZSdcdDogZnVuY3Rpb24oZSl7XG5cdFx0XHRcdGUucHJldmVudERlZmF1bHQoKTtcblx0XHRcdFx0dGhpcy5jb250cm9sbGVyLnJlbW92ZUl0ZW0oIHRoaXMgKTtcblx0XHRcdH0sXG5cdFx0XHQnY2xpY2sgLmFkZC1zY2FsZWQnIDogZnVuY3Rpb24oZSkge1xuXHRcdFx0XHRlLnByZXZlbnREZWZhdWx0KCk7XG5cdFx0XHRcdHRoaXMuYWRkU2NhbGVkKHtcblx0XHRcdFx0XHRmYWN0b3I6Mixcblx0XHRcdFx0XHRrZXk6J3NjYWxlZCcsXG5cdFx0XHRcdFx0c2l6ZV9rZXk6dGhpcy5tb2RlbC5rZXlcblx0XHRcdFx0fSk7XG5cdFx0XHR9LFxuXHRcdFx0J2NoYW5nZSBbZGF0YS1wcm9wPVwid2lkdGhcIl0sW2RhdGEtcHJvcD1cImhlaWdodFwiXScgOiAndXBkYXRlUmF0aW8nXG5cdFx0fSxcblx0XHRpbml0aWFsaXplOmZ1bmN0aW9uKCl7XG5cdFx0XHR3cC5tZWRpYS5WaWV3LnByb3RvdHlwZS5pbml0aWFsaXplLmFwcGx5KHRoaXMsYXJndW1lbnRzKTtcblx0XHRcdHJldHVybiB0aGlzO1xuXHRcdH0sXG5cdFx0cmVuZGVyOmZ1bmN0aW9uKCl7XG5cdFx0XHR2YXIgc2VsZiA9IHRoaXM7XG5cdFx0XHR3cC5tZWRpYS5WaWV3LnByb3RvdHlwZS5yZW5kZXIuYXBwbHkodGhpcyxhcmd1bWVudHMpO1xuXHRcdFx0dGhpcy4kc2NhbGVkTGlzdCA9IHRoaXMuJCgnLnNjYWxlZCAuc2NhbGVkLWxpc3QnKTtcblx0XHRcdHRoaXMuJHJhdGlvID0gdGhpcy4kKCcucmF0aW8nKTtcblx0XHRcdHRoaXMuJHdpZHRoSW5wID0gdGhpcy4kKCdbZGF0YS1wcm9wPVwid2lkdGhcIl0nKTtcblx0XHRcdHRoaXMuJGhlaWdodElucCA9IHRoaXMuJCgnW2RhdGEtcHJvcD1cImhlaWdodFwiXScpO1xuXHRcdFx0Xy5lYWNoKHRoaXMub3B0aW9ucy5tb2RlbCwgZnVuY3Rpb24oIHZhbCwgcHJvcCkge1xuXHRcdFx0XHR2YXIgJGlucCA9IHNlbGYuJCgnW2RhdGEtcHJvcD1cIicrcHJvcCsnXCJdJyksXG5cdFx0XHRcdFx0c2NhbGVkO1xuXHRcdFx0XHRpZiAoXy5pc0Jvb2xlYW4odmFsKSApIHtcblx0XHRcdFx0XHQkaW5wLnByb3AoJ2NoZWNrZWQnLHZhbCk7XG5cdFx0XHRcdH0gZWxzZSBpZiAoIF8uaXNTdHJpbmcodmFsKSB8fCBfLmlzTnVtYmVyKHZhbCkgKSB7XG5cdFx0XHRcdFx0JGlucC52YWwodmFsKTtcblx0XHRcdFx0fSBlbHNlIGlmIChwcm9wID09PSAnc2NhbGVkJykge1xuXHRcdFx0XHRcdF8uZWFjaCh2YWwsZnVuY3Rpb24oIGZhY3Rvciwga2V5ICl7XG5cdFx0XHRcdFx0XHRzZWxmLmFkZFNjYWxlZCh7XG5cdFx0XHRcdFx0XHRcdGZhY3RvcjpmYWN0b3IsXG5cdFx0XHRcdFx0XHRcdGtleTprZXksXG5cdFx0XHRcdFx0XHRcdHNpemVfa2V5OnNlbGYubW9kZWwua2V5XG5cdFx0XHRcdFx0XHR9KTtcblx0XHRcdFx0XHR9KTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHR0aGlzLnVwZGF0ZVJhdGlvKCk7XG5cdFx0XHRyZXR1cm4gdGhpcztcblx0XHR9LFxuXHRcdHVwZGF0ZVJhdGlvOiBmdW5jdGlvbihlKSB7XG5cdFx0XHR2YXIgcmF0aW8sXG5cdFx0XHRcdHcgPSBwYXJzZUludCh0aGlzLiR3aWR0aElucC52YWwoKSksXG5cdFx0XHRcdGggPSBwYXJzZUludCh0aGlzLiRoZWlnaHRJbnAudmFsKCkpLFxuXHRcdFx0XHRybmQgPSBmdW5jdGlvbihudW0pIHtcblx0XHRcdFx0XHR2YXIgcHJlYyA9IE1hdGgucG93KDEwLG9wdC5yb3VuZGluZ19wcmVjaXNpb24pO1xuXHRcdFx0XHRcdHJldHVybiAoTWF0aC5yb3VuZChudW0gKiBwcmVjKSAvIHByZWMpLnRvU3RyaW5nKDEwKTtcblx0XHRcdFx0fTtcblx0XHRcdHJhdGlvID0gdyA+PSBoID8gJzEgOiAnICsgcm5kKCB3IC8gaCApIDogcm5kKCBoIC8gdyApICsgJyA6IDEnO1xuXG5cdFx0XHR0aGlzLiRyYXRpby50ZXh0KCByYXRpbyApO1xuXHRcdH0sXG5cdFx0YWRkU2NhbGVkOmZ1bmN0aW9uKGRhdGEpe1xuXHRcdFx0dmFyIHNjYWxlZCA9IG5ldyBTaXplU2NhbGVkVmlldyh7XG5cdFx0XHRcdG1vZGVsOmRhdGFcblx0XHRcdH0pO1xuXG5cdFx0XHRzY2FsZWQucmVuZGVyKCkuJGVsLmluc2VydEJlZm9yZSggdGhpcy4kc2NhbGVkTGlzdC5jaGlsZHJlbigpLmxhc3QoKSApO1xuXHRcdH0sXG5cdFx0cHJlcGFyZTpmdW5jdGlvbigpIHtcblx0XHRcdHJldHVybiB0aGlzLm9wdGlvbnMubW9kZWw7XG5cdFx0fVxuXHR9KTtcblx0ZnVuY3Rpb24gc2V0U2l6ZXMoIHNpemVzICkge1xuXHRcdHNpemVzVmlldy5yZXNldCgpO1xuXHRcdF8uZWFjaCggc2l6ZXMsIGZ1bmN0aW9uKCBzaXplLCBpICl7XG5cdFx0XHRzaXplc1ZpZXcuYWRkSXRlbSggc2l6ZSApO1xuXHRcdH0pO1xuXHR9XG5cdGZ1bmN0aW9uIGFkZFNpemUoKSB7XG5cdFx0c2l6ZXNWaWV3LmFkZEl0ZW0oe1xuXHRcdFx0bmFtZTonJyxcblx0XHRcdGtleTonaW1hZ2Utc2l6ZS0nICsgKHNpemVzVmlldy5pdGVtcy5sZW5ndGggKyAxKSxcblx0XHRcdHdpZHRoOjEwMCxcblx0XHRcdGhlaWdodDoxMDAsXG5cdFx0XHRzZWxlY3RhYmxlOmZhbHNlLFxuXHRcdFx0Y3JvcDp0cnVlLFxuXHRcdH0pO1xuXHR9XG5cdGZ1bmN0aW9uIGluaXQoKSB7XG5cdFx0c2l6ZXNWaWV3ID0gbmV3IFNpemVzVGFibGVWaWV3KCB7IGVsOiAkKCcuc2l6ZXMtbGlzdCcpLmdldCgwKSB9ICk7XG5cdFx0JHBsYWNlaG9sZGVyID0gJCgnLnNpemVzLWxpc3QgLnBsYWNlaG9sZGVyJyk7XG5cdFx0c2V0U2l6ZXMoIG9wdC5zaXplcy5jdXJyZW50ICk7XG5cdFx0JCgnLnJvYm9jcm9wLXNpemVzLXRhYmxlIC5zYXZlLXRoZW1lJykucHJvcCgnZGlzYWJsZWQnLCAhIG9wdC50aGVtZV9zaXplc19lbmFibGVkICk7XG5cdFx0JCgnLnJvYm9jcm9wLXNpemVzLXRhYmxlIC5sb2FkLXRoZW1lJylcblx0XHRcdC5wcm9wKCdkaXNhYmxlZCcsICEgb3B0LnRoZW1lX3NpemVzX2VuYWJsZWQgfHwgb3B0LnNpemVzLnRoZW1lID09PSBmYWxzZSApO1xuXHR9XG5cblx0JChkb2N1bWVudClcblx0XHQucmVhZHkoaW5pdClcblx0XHQub24oJ2NsaWNrJywnLnJvYm9jcm9wLXNpemVzLXRhYmxlIC5hZGQnLGZ1bmN0aW9uKGUpe1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0YWRkU2l6ZSgpO1xuXHRcdH0pXG5cdFx0Lm9uKCdjbGljaycsJy5yb2JvY3JvcC1zaXplcy10YWJsZSAucmVzZXQnLGZ1bmN0aW9uKGUpe1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0c2V0U2l6ZXMoIG9wdC5zaXplcy5vcmlnaW5hbCApO1xuXHRcdH0pXG5cdFx0Lm9uKCdjbGljaycsJy5yb2JvY3JvcC1zaXplcy10YWJsZSAubG9hZC10aGVtZScsIGZ1bmN0aW9uKGUpe1xuXHRcdFx0ZS5wcmV2ZW50RGVmYXVsdCgpO1xuXHRcdFx0c2V0U2l6ZXMoIG9wdC5zaXplcy50aGVtZSApO1xuXHRcdH0pO1xuXG59KShqUXVlcnkpXG4iXX0=
